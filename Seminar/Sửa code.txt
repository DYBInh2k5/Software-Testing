/// <reference types="cypress" />

describe('Login Function - Full Test Suite', () => {

  // ------------------------------------------------------------
  //                   GLOBAL HOOKS
  // ------------------------------------------------------------

  before(() => {
    cy.log('ðŸ”¹ Báº¯t Ä‘áº§u toÃ n bá»™ Test Suite')
  })

  beforeEach(() => {
    cy.visit('https://practicetestautomation.com/practice-test-login/')
    cy.viewport(1280, 720)
  })

  afterEach(function () {
    const testName = this.currentTest.title.replace(/[:/\\?<>|"]/g, '_')
    cy.screenshot(`screens/${testName}`)
    cy.log('âœ… Test Case hoÃ n táº¥t & chá»¥p áº£nh káº¿t quáº£')
  })

  after(() => {
    cy.log('ðŸ Káº¿t thÃºc toÃ n bá»™ Test Suite')
  })



  // ------------------------------------------------------------
  //                   TEST CASES CHÃNH THá»¨C
  // ------------------------------------------------------------

  it('TC01 - Login Ä‘Ãºng thÃ´ng tin', () => {
    cy.fixture('loginData').then((data) => {

      cy.get('#username')
        .focus()
        .type(data.validUser.username)
        .should('have.value', data.validUser.username)

      cy.get('#password')
        .type(data.validUser.password)

      cy.get('#submit')
        .scrollIntoView()
        .click()
        .should('be.enabled')

      cy.url().should('include', 'logged-in-successfully')
      cy.contains('Congratulations').should('be.visible')
    })
  })



  it('TC02 - Sai máº­t kháº©u', () => {
    cy.fixture('loginData').then((data) => {

      cy.get('#username').type(data.invalidUser.username)
      cy.get('#password').type(data.invalidUser.password)

      cy.get('#submit').click()

      cy.contains('Your password is invalid!')
        .should('be.visible')
    })
  })



  it('TC03 - Sai username', () => {
    cy.fixture('loginData').then((data) => {

      cy.get('#username').type(data.unknownUser.username)
      cy.get('#password').type(data.unknownUser.password)

      cy.get('#submit').click()

      cy.contains('Your username is invalid!')
        .should('be.visible')
    })
  })



  it('TC04 - Username rá»—ng', () => {
    cy.get('#password').type('Password123')
    cy.get('#submit').click()

    cy.contains('Please enter username')
      .should('be.visible')
  })



  it('TC05 - Password rá»—ng', () => {
    cy.get('#username').type('student')
    cy.get('#submit').click()

    cy.contains('Please enter password')
      .should('be.visible')
  })



  it('TC06 - Cáº£ hai trÆ°á»ng rá»—ng', () => {
    cy.get('#submit')
      .trigger('mouseover')
      .click()

    cy.contains('Please enter username')
      .should('be.visible')
  })



  it('TC07 - Username cÃ³ khoáº£ng tráº¯ng', () => {
    cy.fixture('loginData').then((data) => {

      cy.get('#username')
        .type('   ' + data.validUser.username + '   ')
        .blur()

      cy.get('#password').type(data.validUser.password)

      cy.get('#submit').click()

      cy.url().should('include', 'logged-in-successfully')
    })
  })



  it('TC08 - Username chá»©a kÃ½ tá»± Ä‘áº·c biá»‡t', () => {
    cy.get('#username').type('stu@dent!')
    cy.get('#password').type('Password123')

    cy.get('#submit').dblclick()

    cy.contains('Your username is invalid!')
      .should('be.visible')
  })



  it('TC09 - Password cÃ³ khoáº£ng tráº¯ng', () => {
    cy.get('#username').type('student')
    cy.get('#password').type('   Password123   ')

    cy.get('#submit').click()

    cy.url().should('include', 'logged-in-successfully')
  })



  it('TC10 - SQL Injection', () => {
    cy.get('#username').type("' OR '1'='1")
    cy.get('#password').type("' OR '1'='1")

    cy.get('#submit').click()

    cy.contains('Your username is invalid!')
      .should('be.visible')
  })



  it('TC11 - XSS Injection', () => {
    const xss = `<script>alert("XSS")</script>`

    cy.get('#username').type(xss)
    cy.get('#password').type('Password123')

    cy.get('#submit').click()

    cy.contains('Your username is invalid!')
      .should('be.visible')
  })



  it('TC12 - Username viáº¿t hoa', () => {
    cy.get('#username').type('STUDENT')
    cy.get('#password').type('Password123')

    cy.get('#submit').click()

    cy.url().should('include', 'logged-in-successfully')
  })



  it('TC13 - Kiá»ƒm tra Placeholder & UI', () => {
    cy.get('#username').should('have.attr', 'placeholder', 'Username')
    cy.get('#password').should('have.attr', 'placeholder', 'Password')

    cy.get('#submit').should('be.visible')
  })



  it('TC14 - Check nÃºt Login bá»‹ disable náº¿u chÆ°a nháº­p gÃ¬ (náº¿u site há»— trá»£)', () => {
    cy.get('#submit').should('be.enabled')  
    // náº¿u website khÃ´ng disable button â†’ chá»‰nh láº¡i expectation táº¡i Ä‘Ã¢y
  })



  it('TC15 - Spam login 5 láº§n liÃªn tá»¥c', () => {
    for (let i = 0; i < 5; i++) {
      cy.get('#username').clear().type('wrongUser')
      cy.get('#password').clear().type('wrongPass')
      cy.get('#submit').click()
      cy.wait(300)
    }

    cy.contains('Your username is invalid!')
      .should('be.visible')
  })

})
